// This code used to be inside fileBrowser.html , but was annoying that way because
// Chrome debugger wouldn't allow debugging js code changes any way I could find.
function fbInit(){if("undefined"==typeof file_Browser_params&&(file_Browser_params=new Object),"boolean"!=typeof file_Browser_params.directory_browser&&(file_Browser_params.directory_browser=!1),"function"!=typeof file_Browser_params.on_folder_select&&(file_Browser_params.on_folder_select=null),"function"!=typeof file_Browser_params.on_file_select&&(file_Browser_params.on_file_select=null),"function"!=typeof file_Browser_params.on_ok&&(file_Browser_params.on_ok=null),void 0===file_Browser_params.new_file_btn&&(file_Browser_params.new_file_btn=!0),void 0===file_Browser_params.new_folder_btn&&(file_Browser_params.new_folder_btn=!0),void 0===file_Browser_params.ok_btn&&(file_Browser_params.ok_btn=!0),void 0===file_Browser_params.default_fileName&&(file_Browser_params.default_fileName="untitled.txt"),void 0===file_Browser_params.custom_title&&(file_Browser_params.custom_title=null),void 0===file_Browser_params.confirm_selected_file&&(file_Browser_params.confirm_selected_file=!1),void 0===file_Browser_params.confirm_selected_file_prompt&&(file_Browser_params.confirm_selected_file_prompt="Are you sure you want to select this file?"),"function"!=typeof file_Browser_params.on_cancel_file_browse&&(file_Browser_params.on_cancel_file_browse=null),void 0===file_Browser_params.del_file_btn&&(file_Browser_params.del_file_btn=!1),void 0===file_Browser_params.rename_file_btn&&(file_Browser_params.rename_file_btn=!1),file_Browser_params.new_file_btn||$("#new_file_btn").hide(),file_Browser_params.new_folder_btn||$("#new_dir_btn").hide(),file_Browser_params.ok_btn||$("#file_browser_ok").hide(),"string"==typeof file_Browser_params.custom_title&&$("#FileBrowserTitleBar").text(file_Browser_params.custom_title),$("#new_file_btn").click(function(){if(null!=currEntry){var e=prompt("Enter File Name",file_Browser_params.default_fileName)
null!=e&&""!=e&&currEntry.getFile(e,{create:!1},function(){alert("File already exists")},function(){currEntry.getFile(e,{create:!0},function(){fbGetEntries(currEntry)},function(){alert("Error creating file "+e)})})}}),$("#new_dir_btn").click(function(){if(null!=currEntry){var e=prompt("Enter Folder Name","untitled")
null!=e&&""!=e&&currEntry.getDirectory(e,{create:!1},function(){alert("Folder already exists")},function(){currEntry.getDirectory(e,{create:!0},function(){fbGetEntries(currEntry)},function(){alert("Error creating file "+e)})})}}),$("#file_browser_ok").click(function(){null!=file_Browser_params.on_ok&&(file_Browser_params.on_ok(currEntry),bClosingDialogByCallbackRequest=!0)}),void 0===file_Browser_params.initial_folder||null==file_Browser_params.initial_folder)file_Browser_params.initial_folder=null,fbGetRootAndDisplay()
else{var e=file_Browser_params.initial_folder.nativeURL
window.resolveLocalFileSystemURL(e),fbGetEntries(file_Browser_params.initial_folder)}$("#rk_file_dialog").bind("pagehide",function(){bClosingDialogByCallbackRequest||null!=file_Browser_params.on_cancel_file_browse&&file_Browser_params.on_cancel_file_browse()})}function fbGetRootAndDisplay(){fbGetRoot(function(e){try{fbGetEntries(e)}catch(e){fbAlertError(e)}})}function fbGetRoot(e){return void 0!==window.requestFileSystem&&window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(r){void 0!==e&&e(r.root)},function(){log("Error accessing local file system")}),null}function fbUpOneLevel(){null!=currEntry&&currEntry.getParent(function(e){fbGetEntries(e)},function(e){alert("Error getting parent folder")})}function fbGetEntries(e){if(null!=e){currPath=e.fullPath,currEntry=e,$("#curr_folder").html(currPath)
e.createReader().readEntries(function(e){fbDisplayEntries(e)},function(e){void 0!==e.message&&(e=e.message),alert(e)})}}function fbDisplayEntries(e){e.sort(function(e,r){var i=e.name.toLowerCase(),l=r.name.toLowerCase()
return i<l?-1:i>l?1:0})
var r="D",i="F"
r='<img class="EntryTypeIcon" src="imgs/folder.svg" />',i='<img class="EntryTypeIcon" src="imgs/file.svg" />',$("#fileBrowser_entries").empty()
var l=$("<table id='file_entry_table'></table>").appendTo("#fileBrowser_entries"),t=$("<tr class='file_list_row'>"+r+"<td>..</td></tr>").appendTo(l)
$(t).click(function(e){fbUpOneLevel()})
for(var n in e){var a=e[n].isDirectory,o=e[n].name
if(!file_Browser_params.directory_browser||a){var t=$("<tr class='file_list_row'></tr>").appendTo(l)
$(t).data("entry",e[n])
var s=null
if(!a&&(file_Browser_params.rename_file_btn===!0||file_Browser_params.del_file_btn===!0)){if(s=$('<span class="file_field_extra"></span>'),file_Browser_params.rename_file_btn===!0){var _=$('<a class="file_rename_btn">R</a>')
_.click(function(e){var r=$(this).closest("tr").data("entry"),i=prompt("New file name",r.name)
r.name!=i&&currEntry.getFile(r.name,{create:!1},function(e){e.moveTo(currEntry,i,function(){fbGetEntries(currEntry)},function(){alert("Failed to rename file")})},function(){alert("Error")})}),s.append(_)}if(file_Browser_params.del_file_btn===!0){var _=$('<a class="file_del_btn">X</a>')
_.click(function(e){var r=$(this).closest("tr").data("entry")
currEntry.getFile(r.name,{create:!1},function(e){e.remove(function(){fbGetEntries(currEntry)},function(){alert("Failed to delete file")})},function(){alert("Error")})}),s.append(_)}}$("<td class='file_icon'>"+(a?r:i)+"</td>").appendTo(t)
var f=$("<td class='file_name'>"+o+"</td>")
null!=s&&f.append(s),f.appendTo(t),$(t).click(function(e){var r=$(this).data("entry")
if(r.isDirectory){if(null!=file_Browser_params.on_folder_select){var i=file_Browser_params.on_folder_select(r)
if(0==i)return bClosingDialogByCallbackRequest=!0,void $(".ui-dialog").dialog("close")}fbGetEntries(r)}else if(null!=file_Browser_params.on_file_select){var l=!1
if(file_Browser_params.confirm_selected_file){var t=file_Browser_params.confirm_selected_file_prompt+" "+r.name
confirm(t)||(l=!0)}if(!l){var i=file_Browser_params.on_file_select(r)
if(0==i)return bClosingDialogByCallbackRequest=!0,void $(".ui-dialog").dialog("close")}}})}}}function fbAlertError(e){void 0!==e.message&&(e=e.message),alert(e)}var currPath="",currEntry=null,bClosingDialogByCallbackRequest=!1
